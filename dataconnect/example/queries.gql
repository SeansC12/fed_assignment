mutation CreateUser($email: String!, $passwordHash: String!) @auth(level: PUBLIC, insecureReason: "Email and password checked before creation") {
  user_insert(data: {
    email: $email,
    passwordHash: $passwordHash,
    createdAt_expr: "request.time",
    updatedAt_expr: "request.time"
  })
}

query GetUserByEmail($email: String!) @auth(level: PUBLIC, insecureReason: "Email is checked for verification") {
  users(where: {email: {eq: $email}}) {
    id
    email
    displayName
    profilePictureUrl
  }
}

mutation CreateSession($userId: UUID!, $sessionToken: String!, $ipAddress: String, $expiresAt: Timestamp!) @auth(level: USER) {
  session_insert(data: {
    userId: $userId,
    sessionToken: $sessionToken,
    ipAddress: $ipAddress,
    createdAt_expr: "request.time",
    expiresAt: $expiresAt
  })
}

mutation DeleteSession($id: UUID!) @auth(level: USER) {
  session_delete(key: {id: $id})
}